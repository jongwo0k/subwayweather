<% if (username) { %>
  <p><%= username %>ìœ¼ë¡œ ì ‘ì†</p>
<% } %>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/mainStyle.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  <header>
    <h1>SubwayWeather</h1>
    <nav>
      <a href="/logout" class="nav-link">ë¡œê·¸ì•„ì›ƒ</a>
      <a href="/favorites" class="nav-link">ì¦ê²¨ì°¾ê¸°</a>
    </nav>
  </header>

  <section id="slideImage">
    <div class="slideshow">
      <img src="/image/main1.png" alt="ì§€í•˜ì²  ì—­" class="slide">
      <img src="/image/main2.png" alt="ìš°ì‚°" class="slide">
    </div>
  </section>
  
  <section id="search">
    <h2>ì¶œë°œì—­ê³¼ ë„ì°©ì—­ì„ ì…ë ¥í•˜ì„¸ìš”</h2>
    <form id="search-form">
      <label for="departure">ì¶œë°œì—­:</label>
      <input type="text" id="departure" name="departure" required>
      <input type="number" min="1" max="8" id="departure-line" name="departure-line" required>í˜¸ì„ 
      <label for="arrival">ë„ì°©ì—­:</label>
      <input type="text" id="arrival" name="arrival" required>
      <label for="transferStation">í™˜ìŠ¹ì—­:</label>
      <input type="text" id="transferStation" name="transferStation">
      <button type="submit">ì¡°íšŒ</button>
    </form>
  </section>

  <section id="results" style="display: none;">
  <h2>ê²°ê³¼</h2>

  <!-- ì¶œë°œì—­ ì‹¤ì‹œê°„ ë„ì°© ì •ë³´ -->
  <div id="subway-results">
    <h3>ì¶œë°œì—­ ì§€í•˜ì²  ë„ì°© ì •ë³´</h3>
    <ul id="subway-info-list"></ul>
  </div>

  <!-- ë„ì°©ì—­ ì˜ˆìƒ ë„ì°© ì‹œê°„ -->
  <div id="arrival-results">
    <h3>ë„ì°©ì—­ ì˜ˆìƒ ë„ì°© ì‹œê°„</h3>
    <p>ì˜ˆìƒ ë„ì°© ì‹œê°„: <span id="expected-time"></span></p>
  </div>

  <!-- ë„ì°©ì—­ ë‚ ì”¨ ì •ë³´ -->
  <div id="weather-results">
    <h3>ë„ì°©ì—­ ë‚ ì”¨ ì •ë³´</h3>
    <p>ì˜¨ë„: <span id="temperature"></span>Â°C</p>
    <p>ë‚ ì”¨: <span id="weather-condition"></span></p>
  </div>
</section>

  <script>
    const form = document.getElementById('search-form');
    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      const departure = document.getElementById('departure').value.trim();
      const arrival = document.getElementById('arrival').value.trim();

      try {
        const response = await axios.get(`/apiData/${departure}/${arrival}`);
        const { weather, subway, expectedArrivalTime } = response.data;

        // ë‚ ì”¨ ì •ë³´ ì—…ë°ì´íŠ¸
        document.getElementById('temperature').textContent = weather.temperature || 'N/A';
        document.getElementById('weather-condition').textContent = weather.isRaining ? 'ğŸŒ§ï¸ ë¹„' : 'â˜€ï¸ ë§‘ìŒ';

        // ì¶œë°œì—­ ì§€í•˜ì²  ë„ì°© ì •ë³´ ì—…ë°ì´íŠ¸
        const subwayInfoList = document.getElementById('subway-info-list');
        subwayInfoList.innerHTML = subway.map(train => `
          <li>${train.trainLine} - ${train.destination} - ${train.arrivalTime}</li>
        `).join('');

        // ë„ì°©ì—­ ì˜ˆìƒ ë„ì°© ì‹œê°„ ì—…ë°ì´íŠ¸
        document.getElementById('expected-time').textContent = expectedArrivalTime || 'N/A';

        // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
        document.getElementById('results').style.display = 'block';
      } catch (error) {
        alert('ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        console.error(error);
      }
    });
  </script>

<section id="Lane">
  <h2>ë…¸ì„ ë„</h2>
  <div class="lane-container">
    <a href="#lane1" class="lane-link"><img src="/image/lane1.png" alt="1í˜¸ì„ " class="lane-image"></a>
    <a href="#lane2" class="lane-link"><img src="/image/lane2.png" alt="2í˜¸ì„ " class="lane-image"></a>
    <a href="#lane3" class="lane-link"><img src="/image/lane3.png" alt="3í˜¸ì„ " class="lane-image"></a>
    <a href="#lane4" class="lane-link"><img src="/image/lane4.png" alt="4í˜¸ì„ " class="lane-image"></a>
    <a href="#lane5" class="lane-link"><img src="/image/lane5.png" alt="5í˜¸ì„ " class="lane-image"></a>
    <a href="#lane6" class="lane-link"><img src="/image/lane6.png" alt="6í˜¸ì„ " class="lane-image"></a>
    <a href="#lane7" class="lane-link"><img src="/image/lane7.png" alt="7í˜¸ì„ " class="lane-image"></a>
    <a href="#lane8" class="lane-link"><img src="/image/lane8.png" alt="8í˜¸ì„ " class="lane-image"></a>
  </div>
</section>

  <div id="lane1" class="lightbox">
    <a href="#" class="close">&times;</a>
    <img src="/image/lane1.png" alt="1í˜¸ì„  í™•ëŒ€">
  </div>
  <div id="lane2" class="lightbox">
    <a href="#" class="close">&times;</a>
    <img src="/image/lane2.png" alt="2í˜¸ì„  í™•ëŒ€">
  </div>
  <div id="lane3" class="lightbox">
    <a href="#" class="close">&times;</a>
    <img src="/image/lane3.png" alt="3í˜¸ì„  í™•ëŒ€">
  </div>
  <div id="lane4" class="lightbox">
    <a href="#" class="close">&times;</a>
    <img src="/image/lane4.png" alt="4í˜¸ì„  í™•ëŒ€">
  </div>
  <div id="lane5" class="lightbox">
    <a href="#" class="close">&times;</a>
    <img src="/image/lane5.png" alt="5í˜¸ì„  í™•ëŒ€">
  </div>
  <div id="lane6" class="lightbox">
    <a href="#" class="close">&times;</a>
    <img src="/image/lane6.png" alt="6í˜¸ì„  í™•ëŒ€">
  </div>
  <div id="lane7" class="lightbox">
    <a href="#" class="close">&times;</a>
    <img src="/image/lane7.png" alt="7í˜¸ì„  í™•ëŒ€">
  </div>
  <div id="lane8" class="lightbox">
    <a href="#" class="close">&times;</a>
    <img src="/image/lane8.png" alt="8í˜¸ì„  í™•ëŒ€">
  </div>

  <footer>
    <p>weather API by <a href="https://www.data.go.kr/" target="_blank">ê³µê³µ ë°ì´í„°í¬í„¸</a></p>
    <p>subway API by <a href="https://data.seoul.go.kr/" target="_blank">ì„œìš¸ ì—´ë¦°ë°ì´í„° ê´‘ì¥</a></p>
  </footer>
</body>
</html>


<% if (error) { %>
  <script>alert("<%= error %>");</script>
<% } %>
